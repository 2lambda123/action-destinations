`#!/usr/bin/env bash`
. "$(dirname "$0")/_/husky.sh"
set -exo pipefail

if ! command -v gitleaks -h &> /dev/null
then
    if -f /.dockerenv
    then
        docker pull zricethezav/gitleaks:latest
        docker run -v ${PWD}:/. zricethezav/gitleaks:latest --path="/."
    else
        if ! command -v brew -v &> /dev/null
        then
            /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        fi

        brew install gitleaks
    fi
fi

gitleaks --repo-url=.git -v --additional-config=".husky/gitleaks-rules.toml" --branch=$(git branch --show-current) --unstaged
